!function(e){angular.module("custom.controllers",[]),app.controller("LoginController",["$scope","$http","$location","$rootScope","$window","$state","$translate","Notification","ReportService","UploadService",function(e,o,n,s,t,r,a,i,l,c){function d(e,o,n,t){"undefined"!=typeof Storage&&(sessionStorage.setItem("_u",JSON.stringify(e)),s.session=JSON.parse(sessionStorage._u)),r.go("home")}function u(e,o,n,s){var t=401==o?a.instant("Login.view.invalidPassword"):e;i.error(t)}app.registerEventsCronapi(e,a),s.http=o,s.Notification=i,s.UploadService=c,s.getReport=function(e,o){l.openReport(e,o)},e.message={},e.login=function(){e.message.error=void 0;var n={username:e.username.value,password:e.password.value};o({method:"POST",url:"auth",data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(d).error(u)}}]),app.controller("HomeController",["$scope","$http","$rootScope","$state","$translate","Notification","ReportService","UploadService",function(e,o,n,s,t,r,a,i){app.registerEventsCronapi(e,t),n.http=o,n.Notification=r,n.UploadService=i,n.getReport=function(e,o){a.openReport(e,o)},e.message={},e.selecionado={valor:1},e.refreshToken=function(){o({method:"GET",url:"auth/refresh"}).success(function(o,n,s,t){console.log("revive :",new Date(o.expires)),sessionStorage.setItem("_u",JSON.stringify(o)),setTimeout(function(){e.refreshToken()},18e5)}).error(function(){})},n.session=sessionStorage._u?JSON.parse(sessionStorage._u):null,n.session?(n.myTheme=n.session.user.theme,e.$watch("myTheme",function(e){void 0!==e&&""!==e&&$("#themeSytleSheet").attr("href","plugins/cronapp-framework-js/css/themes/"+e+".min.css")}),n.session.token&&e.refreshToken()):(s.go("login"),sessionStorage.removeItem("_u")),n.logout=function(){n.session={},"undefined"!=typeof Storage&&sessionStorage.removeItem("_u"),s.go("login")},e.changePassword=function(){function e(e,o,n,a){r.info(t.instant("Home.view.passwordChanged")),s()}function n(e,o,n,s){var a=o>=401?t.instant("Home.view.InvalidPassword"):e;r.error(a)}function s(){oldPassword.value="",newPassword.value="",newPasswordConfirmation.value="",$("#modalPassword").modal("hide")}if(function(){return""!==oldPassword.value&&""!==newPassword.value&&""!==newPasswordConfirmation.value||(""===newPasswordConfirmation.value&&r.error(t.instant("Home.view.ConfirmationPasswordCanNotBeEmpty")),""===newPassword.value&&r.error(t.instant("Home.view.NewPasswordCanNotBeEmpty")),""===oldPassword.value&&r.error(t.instant("Home.view.PreviousPasswordCanNotBeEmpty")),!1)}()){var a={oldPassword:oldPassword.value,newPassword:newPassword.value,newPasswordConfirmation:newPasswordConfirmation.value};o({method:"POST",url:"changePassword",data:$.param(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(e).error(n)}};var l=function(){var e=$(this);e.closest(".sub-menu").length>0&&e.closest(".navbar-nav").collapse("hide")};e.$on("$viewContentLoaded",function(){var e=$(".navbar-nav");e.off("click","a",l),e.on("click","a",l)}),e.themes=["cerulean","cosmo","cyborg","darkly","flatly","journal","lumen","paper","readable","sandstone","simplex","slate","spacelab","superhero","united","yeti"],e.changeTheme=function(e){function s(o,s,t,r){n.session.theme=e,n.session.user.theme=e,sessionStorage.setItem("_u",JSON.stringify(n.session))}function t(e,o,n,s){var t=e;r.error(t)}if(void 0!==e){$("body").append('<div id="transition" />'),$("#transition").css({"background-color":"#FFF",zIndex:1e5,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px",overflow:"hidden",display:"block"}),$("#transition").fadeIn(800,function(){$("#themeSytleSheet").attr("href","plugins/cronapp-framework-js/css/themes/"+e+".min.css"),n.myTheme=e,$("#transition").fadeOut(1e3,function(){$("#transition").remove()})});var a={theme:e};o({method:"POST",url:"changeTheme",data:$.param(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(s).error(t)}}}])}(app),window.safeApply=function(e){var o=this.$root.$$phase;"$apply"==o||"$digest"==o?e&&"function"==typeof e&&e():this.$apply(e)};